background: #f8fafc !important;
padding-bottom: 140px !important; /* Espacio para el crono */
overflow-y: auto !important;
border: none !important;
margin: 0 !important;
}

/* 3. LAS TARJETAS INDIVIDUALES (Cuando navegas: Dotaci√≥n, Ops, etc.) */
body.shift-active .widget.widget--zoomed {
position: fixed !important;
inset: 0 !important;
z-index: 15000 !important; /* Capa Media (Encima del checklist, debajo del crono) */
background: #ffffff !important;
padding: 20px 20px 140px 20px !important; /* Espacio inferior vital para el crono */
overflow-y: auto !important;
margin: 0 !important;
border-radius: 0 !important;
display: block !important;
}

/* Asegurar que la barra de navegaci√≥n (Siguiente/Anterior) se vea bien arriba */
body.shift-active .widget-nav-bar {
position: sticky !important;
top: 0 !important;
z-index: 15001 !important; /* Encima del contenido de la tarjeta */
background: #f1f5f9 !important;
border-bottom: 2px solid #e2e8f0;
padding: 15px !important;
}

/* Botones de navegaci√≥n m√°s grandes en este modo */
body.shift-active .btn-nav {
padding: 12px 24px !important;
font-size: 1.1rem !important;
}
/* =========================================================
  ESTILOS MODIFICADOS: MODO TURNO Y CRON√ìMETRO
  ========================================================= */

/* === CORRECCI√ìN DEL CRON√ìMETRO FLOTANTE === */
/* Esta regla unificada maneja tanto el Modo Turno como la Tarjeta Abierta */
body.shift-mode #timer-widget,
body.card-open #timer-widget {
    position: fixed !important;
    bottom: 30px !important;  /* Margen inferior para no pegarse al borde */
    left: 50% !important;
    transform: translateX(-50%) !important;
    
    /* Z-INDEX CR√çTICO: Debe ser mayor que el de la tarjeta (que es 15000) */
    z-index: 2147483647 !important; 

    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    
    /* Dise√±o visual */
    background: #ffffff !important;
    padding: 10px 30px !important;
    border-radius: 50px !important;
    border: 4px solid #dc2626 !important;
    box-shadow: 0 10px 40px rgba(0,0,0,0.6) !important;
    
    visibility: visible !important;
    opacity: 1 !important;
    width: auto !important;
    height: auto !important;
}

/* Estilos para el texto del cron√≥metro cuando flota */
body.shift-mode #timer-display,
body.card-open #timer-display {
    font-size: 3.5rem !important; /* Texto grande y legible */
    font-weight: 800 !important;
    color: #1f2937 !important;
    margin: 0 15px !important;
}

/* Estilos para el bot√≥n reset cuando flota */
body.shift-mode #timer-reset,
body.card-open #timer-reset {
    width: 45px !important; 
    height: 45px !important;
    font-size: 0 !important; /* Oculta el texto 'Reiniciar' para dejar solo icono si usas */
    background: #ef4444 !important; /* Rojo alerta */
    border-radius: 50% !important;
    position: relative !important;
}
/* Agregamos una pseudo-clase para que el bot√≥n se vea como una 'X' o Reset visualmente */
body.shift-mode #timer-reset::after,
body.card-open #timer-reset::after {
    content: "‚Ü∫"; 
    color: white;
    font-size: 24px;
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
}


</style>
</head>
<body>
<body>

<button id="exit-shift-mode-btn" onclick="exitShiftMode()">Cerrar Vista Turno ‚úñ</button>


<select id="scale-select" aria-label="Escala UI">
<option value="1">100%</option>
<option value="1.15" selected>115%</option>
<option value="1.3">130%</option>
<option value="1.5">150%</option>
</select>
<button id="present-btn" class="btn-primary" type="button" title="Pantalla completa">Presentar</button>



<div class="dashboard-3col">
<!-- HEADER -->
<header>
<div class="header-left">
<h1>Factory Floor Dashboard - WFS4 MAD</h1>
<div id="now-header" role="status" aria-live="polite">‚Äî</div>
<span id="shift-badge-header" class="shift-chip">‚Äî</span>
</div>

<div class="header-timer" id="timer-widget" aria-label="Cron√≥metro">
<div class="timer-face" id="timer-face">
<div class="timer-display" id="timer-display" title="Toca para iniciar/pausar">00:00:00</div>
<span class="timer-dot" aria-hidden="true"></span>
</div>
<button type="button" class="timer-reset" id="timer-reset" disabled>Reiniciar</button>
</div>

<!-- Busca esto en tu header y reempl√°zalo o modif√≠calo -->
<div class="header-controls">
@@ -6215,111 +6214,87 @@
               <div class="nav-group" style="font-size:0.9rem; color:#64748b;">
                   ${step.label} (${index + 1}/${WIDGET_MAP.length})
               </div>
               <div class="nav-group">
                   <button class="btn-nav home" onclick="exitFlow()">Salir ‚úñ</button>
                   <button class="btn-nav next-ok" onclick="markOkAndNext('${step.check}', '${nextStep ? nextStep.id : ''}')">
                       ‚úÖ OK y Siguiente ‚û°
                   </button>
               </div>
           `;
widget.prepend(navBar);
});
}
injectNavigation();

// 3. L√ìGICA DE RESET DEL CRON√ìMETRO Y CHECKLIST
const resetBtn = document.getElementById('timer-reset');
if (resetBtn) {
resetBtn.addEventListener('click', () => {
if (!confirm("¬øReiniciar turno? Se borrar√°n los checks y el tiempo.")) return;

// A. Reset visual checkboxes
document.querySelectorAll('#brief-check input[type="radio"]').forEach(r => r.checked = false);

// B. Borrar localStorage espec√≠fico del checklist
Object.keys(localStorage).forEach(k => {
if(k.includes('brief_check')) localStorage.removeItem(k);
});

// C. Recalcular spotlight (volver al paso 1)
if(window.updateSpotlightRouting) window.updateSpotlightRouting();

// D. Reset texto meta
const meta = document.getElementById('brief-check-meta');
if(meta) meta.textContent = "‚Äî";

console.log("‚ôªÔ∏è Checklist reiniciado.");
});
}
});

// --- FUNCIONES GLOBALES (Window) PARA LOS BOTONES ONCLICK ---

window.navTo = function(targetId) {
    if (!targetId) return;
    // Salir de pantalla completa anterior si la hay
    if (document.exitFullscreen) document.exitFullscreen().catch(() => {});
    document.querySelectorAll('.widget--zoomed').forEach(el => el.classList.remove('widget--zoomed'));

    setTimeout(() => {
        const el = document.getElementById(targetId);
        if (el) {
            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Intentar fullscreen nativo, si falla, usar CSS zoom
            if (el.requestFullscreen) {
                el.requestFullscreen({ navigationUI: 'hide' }).catch(() => el.classList.add('widget--zoomed'));
            } else {
                el.classList.add('widget--zoomed');
            }
        }
    }, 100);
};

window.exitFlow = function() {
    if (document.exitFullscreen) document.exitFullscreen().catch(() => {});
    document.querySelectorAll('.widget--zoomed').forEach(el => el.classList.remove('widget--zoomed'));
    if(window.updateSpotlightRouting) window.updateSpotlightRouting();
};

window.markOkAndNext = function(checkName, nextId) {
// 1. Marcar OK
if (checkName) {
const radio = document.querySelector(`input[name="${checkName}"][value="OK"]`);
if (radio) {
radio.checked = true;
// Disparar eventos para persistencia y spotlight
radio.dispatchEvent(new Event('change', { bubbles: true }));
radio.dispatchEvent(new Event('input', { bubbles: true }));
}
}

// 2. Navegar
if (nextId) {
navTo(nextId);
} else {
// Fin del flujo
exitFlow();
// Scroll suave al bot√≥n de generar
document.querySelector('header').scrollIntoView({behavior:'smooth'});
// Peque√±o feedback
setTimeout(() => alert("üéâ Checklist completado. Ahora puedes generar el resumen."), 300);
}
};


/* =================================================
  PANTALLA MODO INFO (POST-BRIEFING)
  ================================================= */

window.openPostBriefingMode = function() {
console.log("üöÄ Activando Modo Info...");
const screen = document.getElementById('post-briefing-screen');
if (!screen) return console.error("Falta #post-briefing-screen en el HTML");

// 1. Rellenar datos
const prev = document.getElementById('prev-shift-note')?.innerText || "Sin datos";
document.getElementById('pb-prev-content').innerHTML = `<p style="font-size:1.1rem">${prev}</p>`;

const ops = document.querySelectorAll('#ops-list .ops-item .ops-title');
let opsHtml = '<ul style="padding-left:20px">';
if (ops.length === 0) opsHtml += "<li>Sin actualizaciones activas</li>";
@@ -6517,115 +6492,114 @@
}

// PARA PROBARLO AHORA MISMO:
// Escribe en la consola: testShiftMode()
window.testShiftMode = function() {
triggerShiftMode("PRUEBA");
}
// =========================================================
//  L√ìGICA DE NAVEGACI√ìN Y CAMBIO DE TURNO
// =========================================================

(function initAutoShiftChange(){
let lastShift = null;

function checkTime() {
const h = new Date().getHours();
let currentShift = 'Noche';
if (h >= 6 && h < 14) currentShift = 'Ma√±ana';
if (h >= 14 && h < 22) currentShift = 'Tarde';

if (lastShift === null) { lastShift = currentShift; return; }

if (currentShift !== lastShift) {
lastShift = currentShift;

// ACTIVAR MODO TURNO
document.body.classList.add('shift-mode'); // Activa el cron√≥metro flotante

// Resetear Timer
document.getElementById('timer-reset').click();

// Resetear Checks
document.querySelectorAll('#brief-check input[type="radio"]').forEach(r => r.checked = false);

// Enfocar Checklist (Nivel 1)
document.querySelectorAll('.shift-focus').forEach(e => e.classList.remove('shift-focus'));
const checklist = document.getElementById('brief-check');
if(checklist) checklist.classList.add('shift-focus');
}
}
setInterval(checkTime, 1000);
})();

// === NAVEGACI√ìN QUE SIEMPRE ACTIVA EL CRONO ===

// === REEMPLAZAR LAS FUNCIONES navTo Y exitFlow POR ESTAS ===
// === REEMPLAZA LAS FUNCIONES navTo Y exitFlow POR ESTAS ===

// 1. Navegaci√≥n: Abre tarjeta y activa el cron√≥metro flotante
window.navTo = function(targetId) {
    const el = document.getElementById(targetId);
    if (!el) return;

    // A. Limpiar cualquier otra tarjeta que estuviera abierta
    document.querySelectorAll('.widget--zoomed').forEach(w => w.classList.remove('widget--zoomed'));

    // B. ACTIVAR MODO TARJETA (Esto dispara el CSS del cron√≥metro corregido arriba)
    document.body.classList.add('card-open');

    // C. Abrir la tarjeta actual
    el.classList.add('widget--zoomed');
    
    // D. Scroll al inicio (importante para ver la barra de navegaci√≥n superior)
    el.scrollTop = 0;
};
</script>
</body>
</html>



























